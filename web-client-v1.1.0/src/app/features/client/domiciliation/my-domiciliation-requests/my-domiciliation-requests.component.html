<div class="content">
  <h2 class="intro-y text-lg font-medium mt-10">
    My Domiciliation Requests List
  </h2>
  <div class="grid grid-cols-12 gap-6 mt-5">
    <div
      class="intro-y col-span-12 flex flex-wrap xl:flex-nowrap items-center mt-2"
    >
      <div class="flex w-full sm:w-auto"></div>
      <div class="w-full xl:w-auto flex items-center mt-3 xl:mt-0">
        <button
          class="btn btn-primary shadow-md mr-2"
          routerLink="/client/domiciliation-request"
        >
          <i class="w-4 h-4 mr-2 fa-solid fa-plus"></i> New Domiciliation
          Request
        </button>
      </div>
    </div>
    <div
      class="intro-y col-span-12 overflow-auto 2xl:overflow-visible"
      *ngIf="domiciliations && domiciliations.length > 0; else noConsultation"
    >
      <table class="table table-report -mt-2">
        <thead>
          <tr>
            <th class="whitespace-nowrap">SENT AT</th>
            <th class="text-center whitespace-nowrap">DENOMINATION</th>
            <th class="whitespace-nowrap">STATUS</th>
            <th class="text-center whitespace-nowrap">ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr class="intro-x" *ngFor="let item of domiciliations">
            <td class="w-40">
              <div class="text-slate-500 text-xs whitespace-nowrap mt-0.5">
                {{ item.createdAt | date : "MMM d, y 'At' h:mm a" }}
              </div>
            </td>
            <td>
              <div class="whitespace-nowrap">{{ item.denomination }}</div>
            </td>
            <td class="text-center">
              <div
                class="flex items-center justify-center whitespace-nowrap"
                [ngClass]="{
                  'text-success': item.status === 'ACCEPTED',
                  'text-danger': item.status === 'REJECTED',
                  'text-pending': item.status === 'IN_PROGRESS'
                }"
              >
                <i
                  *ngIf="item.status === 'ACCEPTED'"
                  class="w-4 h-4 mr-2 fa-regular fa-circle-check"
                ></i>
                <i
                  *ngIf="item.status === 'REJECTED'"
                  class="w-4 h-4 mr-2 fa-solid fa-ban"
                ></i>
                <i
                  *ngIf="item.status === 'IN_PROGRESS'"
                  class="w-4 h-4 mr-2 fa-regular fa-clock"
                ></i>
                {{ item.status }}
              </div>
            </td>

            <td class="table-report__action">
              <div class="flex justify-center items-center">
                <button
                  class="flex items-center text-primary whitespace-nowrap mr-5"
                  (click)="openDetailsModal(item)"
                >
                  <i class="w-4 h-4 mr-1 fa-regular fa-circle-check"></i> View
                  Details
                </button>
                <button
                  *ngIf="item.status === 'IN_PROGRESS'"
                  (click)="openCancelOrCloseModal(item.id)"
                  class="flex items-center text-primary whitespace-nowrap"
                >
                  <i class="w-4 h-4 mr-1 fa-solid fa-ban"></i> Cancel
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #noConsultation>
      <div
        class="intro-y col-span-12 overflow-auto 2xl:overflow-visible text-center"
      >
        <div class="alert alert-primary-soft mb-1">
          You have not send any consultation request..
        </div>
      </div>
    </ng-template>
  </div>
</div>

<div *ngIf="isDetailsModalOpen" class="modal-overlay">
  <div
    class="modal-content"
    [ngClass]="isDarkModeEnabled() ? 'modal-dark' : 'modal-light'"
  >
    <span class="close" (click)="closeDetailsModal()">&times;</span>

    <div
      class="intro-y flex flex-col sm:flex-row items-center justify-between mt-8"
    >
      <h2 class="text-lg font-medium">Domiciliation Request Details</h2>
    </div>

    <div class="intro-y grid grid-cols-12 gap-5 mt-5">
      <div class="col-span-12 lg:col-span-8 2xl:col-span-6">
        <div class="box p-5 rounded-md">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h3 class="text-xl font-bold">
                {{ selectedDomiciliation.denomination }}
              </h3>
              <div class="flex items-center text-slate-500 text-xs">
                Sent:
                <a class="ml-1 font-medium mr-3">{{
                  selectedDomiciliation.createdAt
                    | date : "MMM d, y 'At' h:mm a"
                }}</a>
              </div>
            </div>
          </div>
          <div class="lg:text-right mt-10 lg:mt-0 lg:ml-auto">
            <div class="text-base text-slate-500">Domiciliation Details</div>
            <div class="mt-1">
              Legal Form: {{ selectedDomiciliation.legalForm }}
            </div>
            <div class="mt-1">
              Company Status: {{ selectedDomiciliation.companyStatus }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.draftStatus">
              Draft Status: {{ selectedDomiciliation.draftStatus }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.shareCapital">
              Share Capital: {{ selectedDomiciliation.shareCapital }} Dinars
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.management">
              Management: {{ selectedDomiciliation.management }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.oldDraftStatus">
              Old Draft Status: {{ selectedDomiciliation.oldDraftStatus }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.oldLegalForm">
              Old Legal Form: {{ selectedDomiciliation.oldLegalForm }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.oldShareCapital">
              Old Share Capital: {{ selectedDomiciliation.oldShareCapital }}
            </div>
            <div class="mt-1" *ngIf="selectedDomiciliation.oldManagement">
              Old Management: {{ selectedDomiciliation.oldManagement }}
            </div>
          </div>
          <div
            class="px-5 sm:px-20 lg:px-20 pb-10 sm:pb-20 lg:pb-20 flex flex-col-reverse sm:flex-row lg:flex-row"
          >
            
            <div class="text-center sm:text-right sm:ml-auto">
              <div class="text-base text-slate-500">Payment Mode</div>
              <div class="text-xl text-success font-medium mt-2">
                {{ selectedDomiciliation.paymentMode }}
              </div>
              <div class="text-base text-slate-500">Pack</div>
              <div class="text-lg text-success font-medium mt-2">
                {{ selectedDomiciliation.pack.designation }}
              </div>
              <div class="mt-1">
                Price : {{ selectedDomiciliation.pack.price }} Dinars
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isCancelModalOpen" class="modal-overlay">
  <div class="modal-content">
    <span class="close" (click)="openCancelOrCloseModal()">&times;</span>

    <div class="intro-y grid grid-cols-11 gap-5 mt-5">
      <div class="col-span-12 lg:col-span-4 2xl:col-span-3">
        <div class="box p-5 rounded-md font-bold text-center">
          <p class="mb-5">Do you want to cancel this domiciliation request?</p>
          <button
            class="btn btn-primary mr-5"
            (click)="confirmCancelRequest()"
            type="button"
          >
            Yes
          </button>
          <button
            class="btn btn-outline-secondary"
            (click)="openCancelOrCloseModal()"
            type="button"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
